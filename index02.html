
<html>
  <head>
<meta charset=UTF-8>
<title>加速度センサーで画像を移動</title>
    <style>
      p {
      	font-size: 12px;
      	margin: 1px;
        color: rgb(0, 0, 0);
      }
    </style>
    <script>
      var cv, ctx;
      var pos_x, pos_y;
      var img = new Image();
      img.src = "Duke.jpg";

      function init() {
      	pos_x = 0;
      	pos_y = 0;
        cv = document.getElementById("main");
        ctx = cv.getContext("2d");
        display();
        window.addEventListener("deviceorientation", handleOrientation(event), true);

      }

      function display() {
        ctx.beginPath();
        ctx.fillRect(0, 0, cv.width, cv.height);

        ctx.save();
        ctx.translate(
        	(cv.width-img.width)/2 + pos_x,
        	(cv.height-img.height)/2 + pos_y);
        ctx.drawImage(img, 0, 0);
        ctx.restore();

        setTimeout(display, 50); // タイマーで定期的に display() を実行
      }

      function handleOrientation(orientData) {
      	var accel_scale = 500.0;
      	var filter_val = 0.1;

      	// ローパスフィルタ
      	pos_x = (orientData.alpha*accel_scale * filter_val) + (pos_x * (1.0 - filter_val));
      	pos_y = (orientData.beta*accel_scale * filter_val) + (pos_y * (1.0 - filter_val));
        var d = document.getElementById("display");
        d.innerHTML = "<p> x = " + orientData.x + "<br />y = " + orientData.y + "</p>";
      }


    }

    </script>
  </head>
  <body onload="init();">
    <div id="display"><p>x = 0<br />y = 0</p></div>
    <canvas id="main" width="300" height="300"></canvas>
  </body>
</html>
